---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { initI18n } from "../../i18n.js";
// --- 【核心修正】: 添加 getStaticPaths 函数 ---
export function getStaticPaths() {
  // 1. 定义我们支持的所有语言代码
  const locales = ["zh", "en"];

  // 2. 为每个语言代码创建一个路径对象
  // Astro 将使用这里的 params.locale 值来渲染页面
  return locales.map((locale) => {
    return {
      params: {
        locale: locale, // 将 locale 赋值给动态参数 [locale]
      },
      // 可以在这里传递额外的 props，例如翻译实例
      // props: { /* ... */ }
    };
  });
}
// ----------------------------------------------------

// 3. 从路由参数中获取语言代码 (现在它不会是 undefined 了)
const locale = Astro.params.locale;
const effectiveLocale = locale;

// 4. 初始化 i18next 实例
const i18nInstance = initI18n(effectiveLocale);
const t = i18nInstance.t.bind(i18nInstance);
const htmlLang = locale === "zh" ? "zh-Hans" :locale;
const pageTitle = t("info.changelog.title");
const pageDescription = t("info.changelog.intro");
const canonicalPath = "/changelog";
---

<BaseLayout
  htmlLang={htmlLang}
  lang={locale}
  t={t}
  pageTitle={pageTitle}
  pageDescription={pageDescription}
  canonicalPath={canonicalPath}
>
  <section class="px-6 md:px-12 lg:px-24 py-20 max-w-7xl mx-auto">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">{t("info.changelog.title")}</h2>
    <p class="text-gray-600 mb-6">{t("info.changelog.intro")}</p>

    <ol class="relative border-l border-gray-200 ml-4">
      <!-- Version 2.0.0 -->
      <li class="mb-10 ml-6">
        <span
          class="absolute flex items-center justify-center w-6 h-6 bg-emerald-100 rounded-full -left-3 ring-8 ring-white"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 text-accent-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 13l4 4L19 7"></path></svg
          >
        </span>
        <h3 class="flex items-center mb-1 text-xl font-bold text-gray-900">
          {t("info.changelog.v2.title")} <span
            class="bg-accent-100 text-accent-700 text-sm font-medium mr-2 px-2.5 py-0.5 rounded ml-3"
            >{t("info.changelog.tags.major")}</span>
        </h3>
        <time class="block mb-2 text-sm font-normal leading-none text-gray-400">{t("info.changelog.v2.date")}</time>
        <div class="text-gray-700 space-y-1">
          <p>
            <span set:html={t("info.changelog.v2.p1")}></span>
          </p>
          <p>
            <span set:html={t("info.changelog.v2.p2")}></span>
          </p>
          <p>
            <span set:html={t("info.changelog.v2.p3")}></span>
          </p>
          <p>
            <span set:html={t("info.changelog.v2.p4")}></span>
          </p>
        </div>
      </li>

      <!-- Version 1.1.0 -->
      <li class="mb-10 ml-6">
        <span
          class="absolute flex items-center justify-center w-6 h-6 bg-accent-100 rounded-full -left-3 ring-8 ring-white"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 text-accent-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg
          >
        </span>
        <h3 class="mb-1 text-xl font-bold text-gray-900">{t("info.changelog.v1_1.title")}</h3>
        <time class="block mb-2 text-sm font-normal leading-none text-gray-400">{t("info.changelog.v1_1.date")}</time>
        <div class="text-gray-700 space-y-1">
          <p>
            <span set:html={t("info.changelog.v1_1.p1")}></span>
          </p>
          <p>
            <span set:html={t("info.changelog.v1_1.p2")}></span>
          </p>
        </div>
      </li>

      <!-- Version 1.0.0 -->
      <li class="ml-6">
        <span
          class="absolute flex items-center justify-center w-6 h-6 bg-accent-100 rounded-full -left-3 ring-8 ring-white"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 text-accent-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.75 17L9 20l-1.25-3M15 17h2.25a2 2 0 002-2V5a2 2 0 00-2-2H9a2 2 0 00-2 2v10a2 2 0 002 2h2.25"
            ></path></svg
          >
        </span>
        <h3 class="mb-1 text-xl font-bold text-gray-900">{t("info.changelog.v1_0.title")}</h3>
        <time class="block mb-2 text-sm font-normal leading-none text-gray-400">{t("info.changelog.v1_0.date")}</time>
        <div class="text-gray-700 space-y-1">
          <p>
            <span set:html={t("info.changelog.v1_0.p1")}></span>
          </p>
          <p>
            <span set:html={t("info.changelog.v1_0.p2")}></span>
          </p>
        </div>
      </li>
    </ol>
  </section>
</BaseLayout>
